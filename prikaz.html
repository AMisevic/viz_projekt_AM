<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive World Map with D3</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <style>
    body { margin: 0; background: #f0f0f0; font-family: sans-serif; }
    svg { width: 100vw; height: 100vh; display: block; }
    .country {
      fill: #cce5df;
      stroke: #333;
      stroke-width: 0.5;
      cursor: pointer;
      transition: fill 0.2s;
    }
    .country:hover {
      fill: #98d4c0;
    }
    .label {
      fill: #111;
      font-size: 8px;
      pointer-events: none;
    }
    #tooltip {
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        color: #333;
    }
  </style>
</head>
<body>
  <svg></svg>
  <div id="tooltip" style="
  position: absolute;
  background: white;
  border: 1px solid #999;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  pointer-events: none;
  opacity: 0;
    "></div>

  <script>
    const svg = d3.select("svg");
    const width = window.innerWidth;
    const height = window.innerHeight;

    const projection = d3.geoMercator()
      .scale(180)
      .translate([width / 2, height / 1.6]);

    const path = d3.geoPath().projection(projection);
    let centered = null;

    // Load TopoJSON and name mapping
    Promise.all([
      d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
      //d3.tsv("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.tsv")
    ]).then(([data]) => {
    const countries = data.features;

    const g = svg.append("g").attr("class", "countries");

    g.selectAll("path")
      .data(countries)
      .join("path")
      .attr("class", "country")
      .attr("d", path)
      .on("click", function (event, d) {
        const [[x0, y0], [x1, y1]] = path.bounds(d);
        const dx = x1 - x0;
        const dy = y1 - y0;
        const x = (x0 + x1) / 2;
        const y = (y0 + y1) / 2;
        const scale = Math.max(1, Math.min(5, 0.9 / Math.max(dx / width, dy / height)));
        const translate = [width / 2 - scale * x, height / 2 - scale * y];

        if (centered === d) {
          svg.selectAll(".country").style("display", "inline");
          //svg.selectAll(".label").style("display", "inline");
          svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);
          centered = null;
        } else {
          svg.selectAll(".country").style("display", other => other === d ? "inline" : "none");
          //svg.selectAll(".label").style("display", other => other === d ? "inline" : "none");
          svg.transition().duration(750).call(
            zoom.transform,
            d3.zoomIdentity.translate(...translate).scale(scale)
          );
          centered = d;
        }
    })
        .on("mouseover", function (event, d) {
        d3.select("#tooltip")
        .style("opacity", 1)
        .html(d.properties.name);
    })
        .on("mousemove", function (event) {
        d3.select("#tooltip")
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 20) + "px");
    })
        .on("mouseout", function () {
        d3.select("#tooltip").style("opacity", 0);
    });

    /*
    g.selectAll("text")
      .data(countries)
      .join("text")
      .attr("class", "label")
      .attr("transform", d => `translate(${path.centroid(d)})`)
      .attr("dy", ".35em")
      .attr("text-anchor", "middle")
      .text(d => d.properties.name)
      .style("font-size", "8px");
    */

    const zoom = d3.zoom().on("zoom", (event) => {
      g.attr("transform", event.transform);
    });

    svg.call(zoom);
  });
  </script>
</body>
</html>